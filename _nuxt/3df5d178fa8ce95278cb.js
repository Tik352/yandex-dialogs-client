(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{360:function(e,t,s){var n=s(366);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,s(20).default)("056a5e4e",n,!0,{})},361:function(e,t,s){var n=s(368);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,s(20).default)("43450eae",n,!0,{})},362:function(e,t,s){var n=s(370);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,s(20).default)("256073be",n,!0,{})},363:function(e,t,s){"use strict";var n=s(35),i=s(7),r=s(47),o=s(189),a=s(190),c=s(27),u=s(364),h=s(191);i(i.S+i.F*!s(192)(function(e){Array.from(e)}),"Array",{from:function(e){var t,s,i,l,p=r(e),g="function"==typeof this?this:Array,d=arguments.length,f=d>1?arguments[1]:void 0,m=void 0!==f,_=0,v=h(p);if(m&&(f=n(f,d>2?arguments[2]:void 0,2)),null==v||g==Array&&a(v))for(s=new g(t=c(p.length));t>_;_++)u(s,_,m?f(p[_],_):p[_]);else for(l=v.call(p),s=new g;!(i=l.next()).done;_++)u(s,_,m?o(l,f,[i.value,_],!0):i.value);return s.length=_,s}})},364:function(e,t,s){"use strict";var n=s(12),i=s(59);e.exports=function(e,t,s){t in e?n.f(e,t,i(0,s)):e[t]=s}},365:function(e,t,s){"use strict";var n=s(360);s.n(n).a},366:function(e,t,s){(e.exports=s(19)(!1)).push([e.i,".search-input{text-align:center}.search-input__speech-toggle{cursor:pointer;text-align:center;display:inline-block;margin:0 auto;border:none;background:none;padding:20px;color:#dcdfe6;outline:none}.search-input__speech-toggle .el-input__icon{transition-duration:.1s}.search-input__speech-toggle:hover{color:#666}.search-input__speech-toggle.active{color:#409eff}",""])},367:function(e,t,s){"use strict";var n=s(361);s.n(n).a},368:function(e,t,s){(e.exports=s(19)(!1)).push([e.i,".message{margin-top:15px;margin-bottom:15px;box-shadow:none!important;border:none;border-radius:0;text-align:left;float:left;transition:none;overflow:visible}.message:hover .el-card__header{opacity:1}.message .el-card__header{opacity:0;padding:2px 10px;border:none}.message .el-card__header .el-button:hover{background:none;color:#999}.message .el-card__body{padding:0}.message__text{padding:5px 10px;border-radius:20px;display:inline-block}.message__text-wrap{border-left:3px solid #fff;margin-left:-3px}.message_my{float:right}.message_my .message__text{float:right;background:#ffe478;border-bottom-right-radius:0}.message_answer .message__text{background:#f0f2f5;border-top-left-radius:0}.message_info .message__text-wrap{border-left-color:#17a2b8}.message_success .message__text-wrap{border-left-color:#28a745}.message_warning .message__text-wrap{border-left-color:#ffc107}.message_error .message__text-wrap{border-left-color:#dc3545}.message__date{margin-left:10px;font-size:.8rem}.message__resend{margin-left:10px;background:none;border:none;padding:0}.message__buttons{margin-top:3px;margin-left:6px}",""])},369:function(e,t,s){"use strict";var n=s(362);s.n(n).a},370:function(e,t,s){(e.exports=s(19)(!1)).push([e.i,".dialog{width:100%;text-align:center}.dialog__messages{overflow-y:scroll;padding:0 1rem;height:calc(100vh - 172px)}.dialog__messages:hover{padding-right:.5rem}.dialog__messages:hover::-webkit-scrollbar{width:1rem}.dialog__messages::-webkit-scrollbar{width:.5rem}.dialog__messages::-webkit-scrollbar-track{background-color:#eee}.dialog__messages::-webkit-scrollbar-thumb{background-color:#a9a9a9;outline:1px solid #708090}",""])},371:function(e,t,s){"use strict";s.r(t);s(84),s(134),s(363),s(48);var n=s(4),i=s.n(n);s(83).a.register({microphone:{width:352,height:512,paths:[{d:"M176 352C229 352 272 309 272 256V96C272 43 229 0 176 0S80 43 80 96V256C80 309 123 352 176 352zM336 192H320C311.2 192 304 199.2 304 208V256C304 330.8 239.5 390.8 163.2 383.4 96.7 376.9 48 317.1 48 250.3V208C48 199.2 40.8 192 32 192H16C7.2 192 0 199.2 0 208V248.2C0 337.8 64 417.7 152 429.9V464H96C87.2 464 80 471.2 80 480V496C80 504.8 87.2 512 96 512H256C264.8 512 272 504.8 272 496V480C272 471.2 264.8 464 256 464H200V430.2C285.7 418.5 352 344.9 352 256V208C352 199.2 344.8 192 336 192z"}]}});var r=s(15),o={props:{value:{default:""}},data:function(){return{lang:"ru-RU",q:this.value,recognition:!1,isSpeechRunning:!1,isSpeechWillStart:!1,runtimeTranscription:"",transcription:[],volume:0,audioContext:!1,lastInput:""}},computed:{volumeScale:function(){var e=this.volume;return this.volume<.01&&(e=0),Math.min(1.5,1+10*e)},speechEngine:function(){return this.$store.state.speechEngine},yandexAPIKey:function(){return this.$store.state.yandexAPIKey},messages:function(){return this.$store.state.messages}},watch:{value:function(e){this.q=e},q:function(e){this.$emit("input",e)},messages:function(e){this.onMessagesChange(e)}},methods:{submit:function(){this.$emit("submit",this.q),this.q=""},onMessagesChange:function(e){this.isSpeechWillStart&&("Робот"==e[e.length-1].author&&(this.isSpeechWillStart=!1,this.speechStart()))},speechStart:function(){({browser:this.speechStartBrowser,yandex:this.speechStartYandex})[this.speechEngine]()},speechStartYandex:function(){var e=this;this.isSpeechRunning||this.recognition&&(this.isSpeechRunning=!0,navigator.getUserMedia({video:!1,audio:!0},this.onGetUserMedia,function(e){console.log("Ошибка доступа к микрофону, возможно, вы запретили его использование.",e)}),ya.speechkit.recognize({apikey:this.yandexAPIKey,utteranceSilence:60,doneCallback:this.onSpeechEndYandex,initCallback:function(){this.isSpeechRunning=!0},errorCallback:function(){var t=i()(regeneratorRuntime.mark(function t(s){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.speechStop();case 2:console.log("Возникла ошибка при запросе к yandex: "+s);case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}))},speechStartBrowser:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.recognition){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.speechStop();case 4:this.recognition.start(),this.isSpeechRunning=!0,navigator.getUserMedia({video:!1,audio:!0},this.onGetUserMedia,function(e){console.log("Ошибка доступа к микрофону, возможно, вы запретили его использование.",e)});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),speechStop:function(){var e=i()(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={browser:this.speechStopBrowser,yandex:this.speechStopYandex},e.next=3,t[this.speechEngine]();case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),speechStopYandex:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.audioContext){e.next=8;break}return e.prev=1,e.next=4,this.audioContext.close();case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:this.volume=0,this.isSpeechRunning=!1;case 10:case"end":return e.stop()}},e,this,[[1,6]])}));return function(){return e.apply(this,arguments)}}(),speechStopBrowser:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.recognition&&this.recognition.stop(),!this.audioContext){e.next=9;break}return e.prev=2,e.next=5,this.audioContext.close();case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:this.volume=0,this.isSpeechRunning=!1;case 11:case"end":return e.stop()}},e,this,[[2,7]])}));return function(){return e.apply(this,arguments)}}(),speechToggle:function(){return this.isSpeechRunning?this.speechStop():this.speechStart()},onSpeechEndYandex:function(){var e=i()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isSpeechRunning){e.next=2;break}return e.abrupt("return");case 2:if(""!==t){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this.speechStop();case 6:this.isSpeechWillStart=!0,this.q=t,this.lastInput=this.q,this.submit();case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),onSpeechEndBrowser:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.speechStop();case 2:if(this.runtimeTranscription){e.next=4;break}return e.abrupt("return");case 4:if(this.runtimeTranscription!=this.lastInput){e.next=6;break}return e.abrupt("return");case 6:this.transcription.push(this.runtimeTranscription),this.q=this.runtimeTranscription,this.lastInput=this.q,this.submit(),this.speechStart();case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),initSpeechApi:function(){console.log("Init speech API: ",this.speechEngine),{browser:this.speechInitBrowser,yandex:this.speechInitYandex}[this.speechEngine]()},speechInitYandex:function(){this.recognition=!0},speechInitBrowser:function(){var e=this;if(window.SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition,SpeechRecognition){this.recognition=new SpeechRecognition;var t=this.recognition;this.speechStop(),t.lang=this.lang,t.interimResults=!1,t.addEventListener("result",function(t){var s=Array.from(t.results).map(function(e){return e[0]}).map(function(e){return e.transcript}).join("");e.runtimeTranscription=s}),t.addEventListener("end",this.onSpeechEndBrowser),this.recognition=t}},onGetUserMedia:function(e){this.audioContext=new AudioContext;var t=this.audioContext.createMediaStreamSource(e),s=this.createAudioMeter(this.audioContext);t.connect(s)},createAudioMeter:function(e,t,s,n){var i=e.createScriptProcessor(512);return i.onaudioprocess=this.volumeAudioProcess,i.clipping=!1,i.lastClip=0,i.volume=0,i.clipLevel=t||.98,i.averaging=s||.95,i.clipLag=n||750,i.connect(e.destination),i.checkClipping=function(){return!!this.clipping&&(this.lastClip+this.clipLag<window.performance.now()&&(this.clipping=!1),this.clipping)},i.shutdown=function(){this.disconnect(),this.onaudioprocess=null},i},volumeAudioProcess:function(e){for(var t,s=e.target,n=e.inputBuffer.getChannelData(0),i=n.length,r=0,o=0;o<i;o++)t=n[o],Math.abs(t)>=s.clipLevel&&(s.clipping=!0,s.lastClip=window.performance.now()),r+=t*t;var a=Math.sqrt(r/i);this.volume=a},clearMessages:function(){this.$store.commit(r.SET_MESSAGES,[])}},mounted:function(){this.initSpeechApi()},destroyed:function(){this.speechStop()}},a=(s(365),s(10)),c=Object(a.a)(o,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"search-input"},[s("button",{class:{"speech-toggle":!0,"search-input__speech-toggle":!0,active:e.isSpeechRunning},attrs:{slot:"suffix"},on:{click:e.speechToggle},slot:"suffix"},[e.recognition?s("icon",{staticClass:"el-icon-speech el-input__icon",style:{transform:"scale("+e.volumeScale+")"},attrs:{name:"microphone"}}):e._e()],1),e._v(" "),s("el-input",{ref:"input",attrs:{clearable:"",autofocus:""},nativeOn:{keydown:[function(t){return("button"in t||!e._k(t.keyCode,"c",void 0,t.key,void 0))&&t.ctrlKey?void(e.q=""):null},function(t){return("button"in t||!e._k(t.keyCode,"l",void 0,t.key,void 0))&&t.ctrlKey?(t.preventDefault(),e.clearMessages(t)):null},function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.submit(t):null},function(t){if(!("button"in t)&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"]))return null;e.$emit("up")}],keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"]))return null;e.$emit("down")}},model:{value:e.q,callback:function(t){e.q=t},expression:"q"}})],1)},[],!1,null,null,null);c.options.__file="SearchInput.vue";var u=c.exports,h=(s(85),s(135)),l={components:{MessageButton:h.a},props:["message"],computed:{isMy:function(){return this.message.author==r.AUTHOR_NAME},text:function(){return this.message.text?this.message.text.split("\n").join("<br>"):""}},methods:{resend:function(){this.$store.commit(r.ADD_MESSAGE,{text:this.message.text,author:r.AUTHOR_NAME}),this.$store.dispatch(r.ALICE_REQUEST,this.message.text)}}},p=(s(367),Object(a.a)(l,function(){var e,t=this,s=t.$createElement,n=t._self._c||s;return n("el-card",{class:(e={message:!0,message_my:t.isMy},e["message_"+t.message.class]=t.message.class,e)},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t._v("\n    "+t._s(t.message.author)+" "),n("span",{staticClass:"message__date"},[t._v(t._s(t.message.date))]),t._v(" "),t.isMy?n("el-button",{staticClass:"message__resend",attrs:{title:"resend",icon:"el-icon-refresh"},on:{click:t.resend}}):t._e()],1),t._v(" "),n("div",{staticClass:"message__text-wrap"},[n("div",{staticClass:"message__text",domProps:{innerHTML:t._s(t.text)}})]),t._v(" "),n("div",{staticClass:"message__buttons"},t._l(t.message.buttons,function(e){return n("MessageButton",{key:e.title,staticClass:"message__button",attrs:{title:e.title,value:e.value,url:e.url,payload:e.payload}})}),1)])},[],!1,null,null,null));p.options.__file="Message.vue";var g={components:{SearchInput:u,Message:p.exports,MessageButton:h.a},data:function(){return{currentMessage:-1,q:""}},computed:{messages:function(){return this.$store.state.messages},tests:function(){return this.$store.state.tests}},watch:{messages:function(){this.$refs.searchInput.$refs.input.focus()}},methods:{onSubmit:function(e){this.currentMessage=-1,this.$store.commit(r.ADD_MESSAGE,{text:e,author:r.AUTHOR_NAME});var t=e.match(/^use (.*)$/);t?this.$store.dispatch(r.SET_WEBHOOK_URL,t[1]):this.$store.dispatch(r.ALICE_REQUEST,e)},previousMessage:function(){this.currentMessage++;var e=this.getMyMessage(this.currentMessage);if(e){if(this.q==e.text)return void this.previousMessage()}else this.currentMessage--,e=this.getMyMessage(this.currentMessage);this.q=e.text},nextMessage:function(){if(-1!=this.currentMessage)if(this.currentMessage--,-1!=this.currentMessage){var e=this.getMyMessage(this.currentMessage);this.q!=e.text?this.q=e.text:this.nextMessage()}else this.q=""},getMyMessage:function(e){var t=this.messages.filter(function(e){return e.author==r.AUTHOR_NAME});return t[t.length-1-e]||!1},getUserId:function(){var e=localStorage.getItem("userId");return e||(e=this.$store.getters.randomGuid,localStorage.setItem("userId",e)),e},getWebhookURLs:function(){try{return JSON.parse(localStorage.getItem("webhookURLs"))}catch(e){return[]}}},mounted:function(){var e=this;this.$store.commit(r.SET_USER_ID,this.getUserId()),this.$store.dispatch(r.SESSION_START),this.$store.commit(r.SET_WEBHOOK_URLS,this.getWebhookURLs()),this.$route.query.use?this.$store.dispatch(r.SET_WEBHOOK_URL,this.$route.query.use):this.$store.dispatch(r.SET_WEBHOOK_URL,localStorage.getItem("webhookURL")),this.$route.query.msg&&setTimeout(function(){e.$store.commit(r.ADD_MESSAGE,{text:e.$route.query.msg,author:r.AUTHOR_NAME}),e.$store.dispatch(r.ALICE_REQUEST,e.$route.query.msg)},1500)},created:function(){this.messages.length>this.$store.state.settings.messageStoreLimit&&this.$store.commit(r.SET_MESSAGES,this.messages.slice(this.messages.length-this.$store.state.settings.messageStoreLimit))},updated:function(){this.$nextTick(function(){this.$refs.messages&&(this.$refs.messages.scrollTop=this.$refs.messages.scrollHeight)})}},d=(s(369),Object(a.a)(g,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"dialog"},[e.messages?s("div",{ref:"messages",staticClass:"messages dialog__messages"},[s("el-row",e._l(e.messages,function(e){return s("el-row",{key:e.id,staticClass:"messages__message"},[s("Message",{attrs:{message:e}})],1)}),1),e._v(" "),e.tests.length>0&&e.$store.state.settings.isBottomTests?s("div",{staticClass:"dialog__tests"},[e._l(e.tests,function(e){return s("MessageButton",{key:e.name,class:{message__button:!0,"message-button_success":!0===e.success,"message-button_error":!1===e.success},attrs:{title:e.name,payload:JSON.stringify({scenarios_test:[e]})}})}),e._v(" "),s("MessageButton",{staticClass:"message__button",attrs:{title:"все тесты",payload:JSON.stringify({scenarios_test:e.tests})}})],2):e._e()],1):e._e(),e._v(" "),s("SearchInput",{ref:"searchInput",on:{submit:e.onSubmit,up:e.previousMessage,down:e.nextMessage},model:{value:e.q,callback:function(t){e.q=t},expression:"q"}})],1)},[],!1,null,null,null));d.options.__file="Dialog.vue";var f={components:{Dialog:d.exports}},m=Object(a.a)(f,function(){var e=this.$createElement;return(this._self._c||e)("Dialog")},[],!1,null,null,null);m.options.__file="index.vue";t.default=m.exports}}]);